<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Treatment and Condition Connections</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet">
  <style>
    #related-posts-graph-container {
      position: relative;
      background-color: black;
      margin: 0 auto;
      width: 100%;
      padding: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #related-posts-graph {
      height: 500px;
      width: 100%;
    }

    .toggle-physics-button {
      background-color: blue;
      color: white;
      padding: 8px 12px;
      border: none;
      border-radius: 4px;
      margin-top: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div id="related-posts-graph-container">
  <div id="related-posts-graph"></div>
  <button class="toggle-physics-button">Toggle Physics</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const treatmentsAndConditions = [
      { title: "Mental Health", tags: ["Mental Health", "Therapy", "Support"] },
      { title: "Cancer", tags: ["Cancer", "Chemotherapy", "Surgery"] },
      { title: "Diabetes", tags: ["Diabetes", "Insulin", "Exercise"] },
      { title: "Heart", tags: ["Heart", "Cholesterol", "Surgery"] },
      { title: "Asthma", tags: ["Asthma", "Inhalers", "Exercise"] },
      { title: "Flu", tags: ["Flu", "Antiviral", "Rest"] },
      { title: "COVID-19", tags: ["COVID-19", "Vaccine", "Prevention"] },
      { title: "Chronic Pain", tags: ["Chronic Pain", "Medication", "Exercise"] },
      { title: "Alzheimer's", tags: ["Alzheimer's", "Memory", "Care"] },
      { title: "Obesity", tags: ["Obesity", "Diet", "Exercise"] },
      { title: "Stroke", tags: ["Stroke", "Rehabilitation", "Physiotherapy"] },
      { title: "Kidney", tags: ["Kidney", "Dialysis", "Transplant"] },
      { title: "Sleep", tags: ["Sleep", "Insomnia", "CPAP"] },
      { title: "Lung", tags: ["Lung", "COPD", "Oxygen"] },
      { title: "Liver", tags: ["Liver", "Hepatitis", "Transplant"] },
      { title: "Weight Loss", tags: ["Obesity", "Surgery", "Diet"] },
      { title: "Parkinson's", tags: ["Parkinson's", "Exercise", "Medication"] },
      { title: "Chronic Fatigue", tags: ["Fatigue", "Exercise", "Support"] },
      { title: "Depression", tags: ["Depression", "Therapy", "Medication"] },
      { title: "HIV", tags: ["HIV", "AIDS", "Medication"] }
    ];

    // Create nodes where the node's ID is based on its title (main tag)
    let nodes = [];
    treatmentsAndConditions.forEach(treatment => {
      nodes.push({
        id: treatment.title,  // Use the main tag as the node ID
        label: treatment.title,
        title: treatment.title
      });
    });

    // Create edges between nodes that share related tags
    let edges = [];
    treatmentsAndConditions.forEach((treatment, index) => {
      for (let i = index + 1; i < treatmentsAndConditions.length; i++) {
        const commonTags = treatment.tags.filter(tag =>
          treatmentsAndConditions[i].tags.includes(tag)
        );
        commonTags.forEach(tag => {
          edges.push({
            from: treatment.title, // Use the main tag of the treatments as node IDs
            to: treatmentsAndConditions[i].title,
            title: `Shared tag: ${tag}`
          });
        });
      }
    });

    // Create the network
    const container = document.getElementById("related-posts-graph");
    const data = {
      nodes: new vis.DataSet(nodes),
      edges: new vis.DataSet(edges)
    };

    const options = {
      physics: {
        enabled: true,
        stabilization: {
          enabled: true,
          iterations: 1000
        },
        barnesHut: {
          gravitationalConstant: -40000, // Further increased repulsion
          centralGravity: 0.005, // Reduced central gravity
          springLength: 500, // Further increased spring length
          springConstant: 0.007, // Weakened spring constant
          damping: 0.06 // Slightly increased damping
        }
      },
      nodes: {
        color: {
          background: '#4CAF50',
          border: '#2E7D32',
          highlight: {
            background: '#81C784',
            border: '#4CAF50'
          }
        },
        font: {
          color: '#ffffff',
          size: 14
        },
        borderWidth: 2,
        size: 25,
        shape: 'dot'
      },
      edges: {
        color: {
          color: '#ffffff',
          highlight: '#81C784'
        },
        width: 2,
        smooth: {
          type: 'continuous'
        }
      },
      interaction: {
        hover: true,
        tooltipDelay: 200
      }
    };

    const network = new vis.Network(container, data, options);
    let isPhysicsEnabled = true;

    // Toggle physics button handler
    document.querySelector(".toggle-physics-button").addEventListener("click", function() {
      isPhysicsEnabled = !isPhysicsEnabled;

      if (isPhysicsEnabled) {
        // Enable physics and let nodes redistribute
        network.setOptions({
          physics: {
            enabled: true,
            stabilization: false
          }
        });
      } else {
        // Disable physics and restore circular layout
        network.setOptions({ physics: { enabled: false } });
        const updatedNodes = calculateCircularPositions(nodes, radius, centerX, centerY);
        data.nodes.update(updatedNodes);
      }
    });

    // Add stabilization complete event
    network.on("stabilizationIterationsDone", function () {
      network.setOptions({ physics: { stabilization: false } });
    });
  });
</script>






</body>
</html>
