<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Treatment and Condition Connections</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet">
  <style>
    #related-posts-graph-container {
      position: relative;
      background-color: black;
      margin: 0 auto;
      width: 100%;
      padding: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #related-posts-graph {
      height: 500px;
      width: 100%;
    }

    .toggle-physics-button {
      background-color: blue;
      color: white;
      padding: 8px 12px;
      border: none;
      border-radius: 4px;
      margin-top: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div id="related-posts-graph-container">
  <div id="related-posts-graph"></div>
  <button class="toggle-physics-button">Toggle Physics</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const treatmentsAndConditions = [
      { id: 1, title: "Cancer Treatment", tags: ["Cancer", "Chemotherapy", "Surgery"] },
      { id: 2, title: "Diabetes Management", tags: ["Diabetes", "Insulin", "Exercise"] },
      { id: 3, title: "Heart Disease Treatment", tags: ["Heart", "Cholesterol", "Surgery"] },
      { id: 4, title: "Asthma Management", tags: ["Asthma", "Inhalers", "Exercise"] },
      { id: 5, title: "Flu Treatment", tags: ["Flu", "Antiviral", "Rest"] },
      { id: 6, title: "COVID-19 Vaccination", tags: ["COVID-19", "Vaccine", "Prevention"] },
      { id: 7, title: "Chronic Pain Relief", tags: ["Chronic Pain", "Medication", "Exercise"] },
      { id: 8, title: "Mental Health Counseling", tags: ["Mental Health", "Therapy", "Support"] },
      { id: 9, title: "Alzheimer's Disease", tags: ["Alzheimer's", "Memory", "Care"] },
      { id: 10, title: "Obesity Treatment", tags: ["Obesity", "Diet", "Exercise"] },
      { id: 11, title: "Stroke Rehabilitation", tags: ["Stroke", "Rehabilitation", "Physiotherapy"] },
      { id: 12, title: "Kidney Disease Management", tags: ["Kidney", "Dialysis", "Transplant"] },
      { id: 13, title: "Sleep Disorder Treatment", tags: ["Sleep", "Insomnia", "CPAP"] },
      { id: 14, title: "Lung Disease Treatment", tags: ["Lung", "COPD", "Oxygen"] },
      { id: 15, title: "Mental Health Therapy", tags: ["Mental Health", "Therapy", "Support"] },
      { id: 16, title: "Liver Disease Management", tags: ["Liver", "Hepatitis", "Transplant"] },
      { id: 17, title: "Cancer Rehabilitation", tags: ["Cancer", "Rehabilitation", "Exercise"] },
      { id: 18, title: "Weight Loss Surgery", tags: ["Obesity", "Surgery", "Diet"] },
      { id: 19, title: "Parkinson's Disease Management", tags: ["Parkinson's", "Exercise", "Medication"] },
      { id: 20, title: "Chronic Fatigue Syndrome", tags: ["Fatigue", "Exercise", "Support"] },
      { id: 21, title: "Depression Treatment", tags: ["Depression", "Therapy", "Medication"] },
      { id: 22, title: "HIV/AIDS Treatment", tags: ["HIV", "AIDS", "Medication"] },
      { id: 23, title: "Unrelated Data 1", tags: ["Unrelated", "Data", "Test"] },
      { id: 24, title: "Unrelated Data 2", tags: ["Unrelated", "Data", "Test"] },
      { id: 25, title: "Unrelated Data 3", tags: ["Test", "Random", "Info"] },
    ];

    // Function to calculate positions for nodes on a circle
    function calculateCircularPositions(nodes, radius, centerX, centerY) {
      const angleStep = (2 * Math.PI) / nodes.length;
      return nodes.map((node, index) => {
        const angle = angleStep * index;
        return {
          ...node,
          x: centerX + radius * Math.cos(angle),
          y: centerY + radius * Math.sin(angle)
        };
      });
    }

    // Create nodes from treatments and conditions
    var nodes = treatmentsAndConditions.map(treatment => ({
      id: treatment.id,
      label: treatment.title,
      title: treatment.title
    }));

    // Create edges connecting nodes based on shared tags
    var edges = [];
    treatmentsAndConditions.forEach((treatment, index) => {
      for (let i = index + 1; i < treatmentsAndConditions.length; i++) {
        const commonTags = treatment.tags.filter(tag => treatmentsAndConditions[i].tags.includes(tag));
        if (commonTags.length > 0) {
          edges.push({ from: treatment.id, to: treatmentsAndConditions[i].id });
        }
      }
    });

    // Set up a circular layout: center of the circle and radius
    const centerX = 0;
    const centerY = 0;
    const radius = 200;

    // Initialize node positions
    nodes = calculateCircularPositions(nodes, radius, centerX, centerY);

    // Create network container
    var container = document.getElementById("related-posts-graph");

    // Define the data set for the network
    var data = {
      nodes: new vis.DataSet(nodes),
      edges: new vis.DataSet(edges)
    };

    // Set up network options with physics turned off initially
    var options = {
      layout: {
        improvedLayout: false, // We handle the circular layout manually
      },
      physics: {
        enabled: false, // Disable physics to keep the circle static initially
      },
      interaction: {
        zoomView: true,
        dragNodes: true
      },
      nodes: {
        color: '#fff',
        font: {
          color: '#ffffff'
        },
        size: 12,
        shape: 'dot'
      },
      edges: {
        color: '#ffffff',
        width: 1
      }
    };

    // Create the network
    var network = new vis.Network(container, data, options);

    // Add edges connecting unrelated data to other nodes
    treatmentsAndConditions.forEach((treatment, index) => {
      if (treatment.title.includes("Unrelated")) {
        // Connect to some treatment that shares a tag (for example)
        const connectedTreatment = treatmentsAndConditions.find(t => t.title.includes("Treatment") && t.id !== treatment.id);
        if (connectedTreatment) {
          edges.push({ from: treatment.id, to: connectedTreatment.id });
        }
      }
    });

    // Update edges
    data.edges.add(edges);

    // Toggle physics functionality
    document.querySelector(".toggle-physics-button").addEventListener("click", function() {
      const currentPhysicsState = options.physics.enabled;
      
      // Toggle the physics setting
      options.physics.enabled = !currentPhysicsState;
      
      // Update the network with new physics setting
      network.setOptions(options);

      // If physics is off, keep the circular layout, if physics is on, let the layout adjust automatically
      if (!options.physics.enabled) {
        nodes = calculateCircularPositions(nodes, radius, centerX, centerY);
        data.nodes.update(nodes);
      } else {
        // Let physics take over the layout
        network.setOptions({
          layout: {
            randomSeed: Math.random() // Use randomSeed to ensure physics calculations start fresh
          }
        });
        network.stabilize(); // Ensure physics starts and stabilizes the layout
      }
    });
  });
</script>

</body>
</html>
